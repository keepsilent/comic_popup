var tipsBox=function(){var r="#ddl-tips-box",i="#ddl-floating-box",n=300,a=function(t){var e=$(window).height(),i=$(t).css("height").replace("px",""),n=parseFloat(e-i)/2;$(t).css("marginTop",n)},o=function(){var t={opacity:1,visibility:"visible"},e={opacity:0,visibility:"hidden"};c(r,t,e),c(r+" > div",t={transform:"translateY(0)"},e={transform:"translateY(-50px)"}),setTimeout(function(){$(r).removeAttr("style"),$(r).html("")},n)},c=function(i,t,n,a){a=$.extend({},{easing:"linear",duration:300},a),$(i).css(t),setTimeout(function(){var t=["all",a.duration+"ms",a.easing].join(" "),e=$.extend({transition:t},n);$(i).css(e),setTimeout("tipsBox.callback('"+i+"')",a.duration)},1)},e=function(){var t={opacity:0,visibility:"hidden"},e={opacity:1,visibility:"visible"};$(i).show(),tipsBox.center(i+"> div"),tipsBox.transition(i,t,e),t={transform:"translateY(-50px)"},e={transform:"translateY(0)"},tipsBox.transition(i+" > div",t,e),$(i+"> div").click(function(t){t.stopPropagation()}),$(i).click(function(t){t.stopPropagation(),s()})},s=function(){var t={opacity:1,visibility:"visible"},e={opacity:0,visibility:"hidden"};c(i,t,e),c(i+" > div",t={transform:"translateY(0)"},e={transform:"translateY(-50px)"}),setTimeout(function(){$(i).removeAttr("style"),$(i).html("")},n)};return{alert:function(t,e,i){var n='<div class="alert-wrap"><h3>'+t+'</h3><p id="tips-alert-close-btn"><a href="'+(i=i||"javascript:void(0);")+'" title="'+(e=e||"知道了")+'">'+e+"</a></p></div>";$(r).html(n),$(r).show(),tipsBox.center(r+" > div.alert-wrap"),$("#tips-alert-close-btn").off("click").on("click",function(){tipsBox.hide()})},confirm:function(t,e,i,n,a){var o='<div class="confirm-wrap"><h3 >'+t+'</h3><table border-collapse="0" border-spacing="0"><tr><td><a href="javascript:tipsBox.hide();" title="'+(a=a||"取消")+'">'+a+"</a></td><td><a href=\"javascript:tipsBox.dynamicFunction('"+e+"','"+i+'\');" title="'+(n=n||"确定")+'">'+n+"</a></td></tr></tabel></div></div>";$(r).html(o),$(r).show(),tipsBox.center(r+" > div.confirm-wrap")},center:a,hide:o,show:function(){var t={opacity:0,visibility:"hidden"},e={opacity:1,visibility:"visible"};$(r).show(),a(r+" > div"),c(r,t,e),c(r+" > div",t={transform:"translateY(-50px)"},e={transform:"translateY(0)"})},loading:function(t){if(1==t)return tpl.renderTpl(r,"alert/loading",config.options),$(r).show(),tipsBox.center(r+" > div.loading-wrap"),!1;$(r).hide()},transition:c,callback:function(t){$(t).css("transition","")},floating:function(t){return(t=t||{title:"提示",width:450,height:200,template:"",data:{}}).btnClose=t.btnClose||1,t.bgClose=t.bgClose||1,tpl.renderTpl(i,t.template,{data:t.data}),a(i+" > div"),e(),!1},hideFloating:s,dynamicFunction:function(t,e){var i="",n=(e=e||"").split(",");for(var a in n)i+='"'+n[a]+'",';return i=i.substring(0,i.length-1),Function("return "+t+"("+i+")")()},clean:function(){$(r).removeAttr("style"),$(r).html("")},autoClose:function(t,e){var i='<div class="alert-wrap" style="text-align: '+(e=e||"left")+'"><h3>'+t+"</h3></div>";$(r).html(i),$(r).show(),tipsBox.center(r+" > div.alert-wrap"),setTimeout(function(){o()},1e3)}}}(),base=function(){var i=function(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)},n=function(t){return""==t||null==t||null==t};return{inArray:function(t,e){for(var i in t)if(t[i]==e)return!0;return!1},getDate:function(t){var e=new Date;e.setDate(e.getDate()+t);var i=e.getFullYear(),n=e.getMonth()+1,a=e.getDate();return parseInt(n)<10&&(n="0"+n),parseInt(a)<10&&(a="0"+a),i+"-"+n+"-"+a},getQueryString:function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),i=window.location.search.substr(1).match(e);return null!=i?decodeURIComponent(i[2]):null},setNumberDecimals:function(t,e){return e=e||2,(t=null!=t&&null!=t&&""!=t?t:0)>parseInt(t)&&0<t?(t=i(t,e)).toFixed(e):t<parseInt(t)&&t<0?(t=i(t,e)).toFixed(e):parseInt(t).toFixed(e)},setDateFormat:function(t,e){var n=new Date(e),a={Y:n.getFullYear(),M:n.getMonth()+1,d:n.getDate(),h:n.getHours(),i:n.getMinutes(),s:n.getSeconds(),q:Math.floor((n.getMonth()+3)/3),S:n.getMilliseconds()};return t=t.replace(/([yYMdhisqS])+/g,function(t,e){var i=a[e];return void 0!==i?(1<t.length&&(i=(i="0"+i).substr(i.length-2)),"M"!==e&&"d"!==e&&"h"!==e&&"i"!==e&&"s"!==e||parseInt(a[e])<10&&(i="0"+parseInt(a[e])),i):"y"===e?(n.getFullYear()+"").substr(3-t.length):t})},getDataLength:function(t){var e=0;for(var i in t)e++;return e},jumpUrl:function(t,e){e=e||"";if(base.isEmptyValue(e))return window.location.href=t,!1;var i=document.createElement("a");return i.setAttribute("target",e),i.setAttribute("href",t),i.click(),!1},getStrLen:function(t){for(var e=0,i=0;i<t.length;i++){var n=t.charCodeAt(i);e+=0<=n&&n<=128?1:2}return e},swapItems:function(t,e,i){return t[e]=t.splice(i,1,t[e])[0],t},trim:function(t,e){var i="";switch(e){case",":i=/(^,*)|(,*$)/g;break;default:i=/(^\s*)|(\s*$)/g}return t.replace(i,"")},ltrim:function(t,e){var i="";switch(e){case",":i=/(^,*)/g;break;case"#":i=/(^#*)/g;break;default:i=/(^\s*)/g}return t.replace(i,"")},rtrim:function(t,e){var i="";switch(e){case",":i=/(,*$)/g;break;case";":i=/(;*$)/g;break;default:i=/(\s*$)/g}return t.replace(i,"")},capitalize:function(t){return t.substring(0,1).toUpperCase()+t.substring(1)},isNumber:function(t,e){var i=/^\d+(\.\d+)?$/;return"decimal"==(e=e||"number")&&(i=/^\d+(\.)?$/),!!i.test(t)},isIntNum:function(t){return!!/^\d+$/.test(t)},isEmptyValue:n,isEmptyObject:function(t){for(var e in t)return!1;return!0},getVal:function(t,e){return $(t).val()},getItemObject:function(t){var e={};for(var i in t)e[i]="";return e},setNumber:function(t,e){return n(t)?0:"int"==(e=e||"int")?parseInt(t):parseFloat(t)},removeHTMLTag:function(t){return t=(t=(t=(t=(t=(t=(t=t.replace(/<\/?[^>]*>/g,"")).replace(/[ | ]*\n/g,"\n")).replace(/&nbsp;/gi,"")).replace(/&lt;/gi,"")).replace(/&gt;/gi,"")).replace(/[div|\/div]/g,"")).replace(/&lt;[ -~]*&gt;/gi,"")}}}(),config=function(){var e={width:$(window).width(),height:$(window).height(),domain:"www.didaolan.cn",templateUrl:"dist/template/",apiUrl:"https://api.didaolan.cn/v1/",debug:"m.com"==window.location.host?1:0},t=function(){$(".ddl-comic-foot-tab").click(function(){var t=$(this).attr("data-type");switch($(this).addClass("active"),$(this).siblings().removeClass("active"),$(this).parent().find("span.iconfont").each(function(){$(this).addClass($(this).attr("data-class"))}),$(this).parent().find("span.iconfont").removeClass("icon-shujiaxuanzhong").removeClass("icon-discoverfill").removeClass("icon-wodexuanzhong"),t){case"site":ddlSite.init(),$(this).find("span.iconfont").removeClass("icon-discover").addClass("icon-discoverfill");break;case"favor":ddlFavor.init(),$(this).find("span.iconfont").removeClass("icon-shujia").addClass("icon-shujiaxuanzhong");break;case"user":ddlUser.init(),$(this).find("span.iconfont").removeClass("icon-31wode").addClass("icon-wodexuanzhong");break;case"reader":base.jumpUrl("./reader.html","_blank")}}),$("#ddl-comic-popup-search-input").bind("keypress",function(t){if(t.stopPropagation(),"13"==t.keyCode){var e=$(this).val();if(!base.isEmptyValue(e)){var i="./search.html?keyword="+encodeURIComponent(e);base.jumpUrl(i,"_blank")}}})};return{init:function(){switch($("#ddl-comic-page").val()){case"search":ddlSearch.init();break;case"reader":ddlReader.init(),console.log("sssss");break;default:ddlFavor.init(),t()}window.onresize=function(){e.width=$(window).width(),e.height=$(window).height()},window.addEventListener("online",function(){}),window.addEventListener("offline",function(){})},getOptions:function(t){return e[t]},getApiUrl:function(t){return e.apiUrl+t}}}();$(document).ready(function(){config.init(),base.isEmptyValue(chrome.runtime)||chrome.runtime.onMessage.addListener(function(t,e,i){switch(t.type){case"flushFavor":$(".ddl-comic-foot li:first-child").hasClass("active")&&ddlFavor.init()}})});var cookie=function(){var n=function(t,e){base.isEmptyValue(chrome.storage)||chrome.storage.local.get(t,function(t){e(t)})};return{set:function(t,e){if(!base.isEmptyValue(chrome.storage)){var i={};i[t]=e,chrome.storage.local.set(i)}},get:n,del:function(t){var e=n(t),i=new Date;i.setTime(i.getTime()-1e3),null!=e&&(document.cookie=t+"="+e+";expires="+i.toGMTString()+";path=/;domain="+window.location.host)}}}(),ddlFavor=function(){var t="#ddl-favor-opera-btn",e=".ddl-comic-favor span.continue-btn",i=".ddl-comic-favor span.delete-btn",n=".ddl-comic-favor li.item-box",s=function(){$(".ddl-comic-favor img.cover").each(function(){var t=$(this),e=$(this).attr("data-src");if(!base.isEmptyValue(e)){var i=new Image;i.src=e,(0<i.fileSize||0<i.width&&0<i.height)&&t.attr("src",e),i.onload=function(){t.attr("src",e)}}})},l=function(){$(e).click(function(t){t.stopPropagation(),base.jumpUrl($(this).attr("data-url"),"_blank")}),$(n).click(function(t){t.stopPropagation(),base.jumpUrl($(this).attr("data-url"),"_blank")}),$(i).click(function(t){t.stopPropagation(),$(this).parent().remove();var n=$(this).attr("data-url");cookie.get("favor",function(t){var e=t.favor||[];for(var i in e)e[i].home==n&&e.splice(i,1);base.getDataLength(e)<=0&&tpl.renderTpl(".ddl-comic-main","favor/nothing"),chrome.runtime.sendMessage({type:"removeFavor",key:"home",value:n}),cookie.set("favor",e)})}),$(t).click(function(){if("normal"==$(this).attr("data-status"))return $(this).css("color","#ffc459"),$(this).attr("data-status","opera"),$(".ddl-comic-favor ul").find("span.continue-btn").hide(),$(".ddl-comic-favor ul").find("span.delete-btn").show(),!1;$(this).removeAttr("style"),$(this).attr("data-status","normal"),$(".ddl-comic-favor ul").find("span.continue-btn").show(),$(".ddl-comic-favor ul").find("span.delete-btn").hide()})};return{init:function(){var c=".ddl-comic-main";cookie.get("favor",function(t){var r=t.favor||[],e="";for(var i in r)e+=r[i].id+",";base.isEmptyValue(e)||(e=base.rtrim(e,",")),ajRequest.post("comic/getComicList",{ids:e},function(t){var e=0;if(0<base.getDataLength(t.data))for(var i in r)if(!base.isEmptyValue(t.data[i])){var n=ddlUnit.getCurrentCatalogList(t.data[i].comic_catalog,r[i].current.url,r[i].type),a=base.getDataLength(n.list);if(r[i].updated=!1,r[i].current.type=n.title,parseInt(r[i].last.total)<parseInt(a)){var o=parseInt(a)-1;r[i].updated=!0,r[i].last.link=n.list[o].link,r[i].last.title=n.list[o].title,e++}}base.getDataLength(r)<=0?tpl.renderTpl(c,"favor/nothing"):(tpl.renderTpl(c,"favor/index",{list:r}),$("#ddl-comic-updated-num").html(e+"本"),s()),l()})})},getTimeAgo:function(t){var e="",i=(new Date).getTime()-t;if(!(i<0)){var n=i/6e4,a=i/36e5,o=i/864e5,r=i/6048e5,c=i/2592e6;if(1<=c&&c<=3)e=" "+parseInt(c)+"月前";else if(1<=r&&r<=3)e=" "+parseInt(r)+"周前";else if(1<=o&&o<=6)e=" "+parseInt(o)+"天前";else if(1<=a&&a<=23)e=" "+parseInt(a)+"小时前";else if(1<=n&&n<=59)e=" "+parseInt(n)+"分钟前";else if(0<=i&&i<=6e4)e="刚刚";else{var s=new Date;s.setTime(t),e=s.getFullYear()+"-"+(s.getMonth()+1<10?"0"+(s.getMonth()+1):s.getMonth()+1)+"-"+(s.getDate()<10?"0"+s.getDate():s.getDate())}return e}},resetChapterName:function(t,e){return t=t.replace(base.trim(e),""),t=(t=(t=base.trim(t)).replace(/(^_*)/g,"")).replace(/(^\-*)/g,"")}}}(),ddlReader=function(){var m={list:[],files:[],UnZipArchive:"",title:"#ddl-comic-title",subtitle:"#ddl-comic-subtitle",wrap:"#ddl-comic-wrap",main:"#ddl-comic-main",item:"#ddl-comic-item",menu:"#ddl-comic-menu",totalPage:"#ddl-comic-total-page",currentPage:"#ddl-comic-current-page",settingBox:"#ddl-comic-reader-setting",sceneBox:"#ddl-comic-reader-scene",sceneBtn:"#ddl-comic-reader-scene-btn",lightBtn:"#ddl-comic-light-btn",settingBtn:"#ddl-comic-setting-btn",restoreBtn:"#ddl-comic-restore-btn",playBtn:"#ddl-comic-play-btn",exitBtn:"#ddl-comic-exit-btn",launchBtn:"#ddl-comic-launch",uploadBtn:"#ddl-reader-upload-file-btn",bugBtn:"#ddl-comic-reader-bug-btn",area:"#ddl-comic-reader-area",setting:{zoom:100,space:25},bodyScrollTop:0},e=function(t){var e=t.attr("data-status");n(e)},n=function(t){if(1==t)return $(m.sceneBox).find("em").hide(),$(m.sceneBox).find("ul").hide(),$("#ddl-comic-reader-scene-btn").attr("data-status",0),!1;$(m.sceneBox).find("em").show(),$(m.sceneBox).find("ul").show(),$("#ddl-comic-reader-scene-btn").attr("data-status",1)},t=function(t){var e=t.html(),i=t.attr("data-type");a(e,i),n(0)},a=function(t,e){switch($(m.uploadBtn).removeAttr("accept").removeAttr("multiple").removeAttr("webkitdirectory"),e){case"zip":$(m.uploadBtn).attr("accept","application/zip"),$(m.uploadBtn).parent().find("span").html("选择 Zip压缩文件");break;case"file":$(m.uploadBtn).attr("webkitdirectory","webkitdirectory"),$(m.uploadBtn).parent().find("span").html("选择 纯文件夹");break;case"image":$(m.uploadBtn).attr("multiple","multiple"),$(m.uploadBtn).parent().find("span").html("选择 批量图片")}$("#ddl-comic-reader-scene-title").html(t),cookie.set("reader_scene",{title:t,type:e})},i=function(t){if(0==t.length)return tipsBox.alert("请选择上传的文件"),$(m.uploadBtn).val(""),!1;switch(t[0].type){case"application/zip":r(t[0]);break;default:c(t)}},g=function(t){if(m.list[t].status)return!1;var e=$(m.item+"-"+t),i=e.attr("data-type"),n={url:e.attr("data-url"),type:e.attr("data-type"),index:t};switch(m.list[t].status=!0,i){case"drop":m.UnZipArchive.loadImage(t,n.url);break;case"file":w(t,n.url)}},o=function(){var t=base.ltrim(m.area,"#");document.getElementById(t).addEventListener("drop",function(t){t.preventDefault();var e=t.dataTransfer.files;i(e)},!1)},r=function(a){m.UnZipArchive=new UnZipArchive(a),m.UnZipArchive.getData(function(){var t=[],e=m.UnZipArchive.getEntries();for(var i in e)s(e[i])&&t.push({url:e[i],type:"drop",status:!1,mode:"load"});var n={list:t,total:base.getDataLength(t),title:a.name.replace(".zip",""),space:"margin-bottom: "+m.setting.space+"px;"};l(n)})},c=function(t){var e=[],i="";for(var n in m.files=t)console.log("files[i].type",t[n].type,t[n].name,t[n].webkitRelativePath),s(t[n].name)&&e.push({url:n,type:"file",status:!1,mode:"load"});if(0<base.getDataLength(e)){var a=m.files[e[0].url].webkitRelativePath,o=a.indexOf("/");i=a.substr(0,o)}i=i||"图片预览",console.log("list",e);var r={list:e,total:base.getDataLength(e),title:i,space:"margin-bottom: "+m.setting.space+"px;"};l(r)},s=function(t,e){if(base.isEmptyValue(t))return!1;e=e||".";var i=t.lastIndexOf(e),n=t.substr(i+1);return-1!==["png","jpg","jpeg","bmp","gif","tiff"].indexOf(n.toLowerCase())},l=function(t){if(console.log("data",t),0==t.total)return tipsBox.alert("无法匹配到相对应的文件"),$(m.uploadBtn).val(""),!1;tpl.renderTpl("body","reader/index",t,3),m.list=t.list,f(),g(0),p(),d(),B()},d=function(){cookie.get("reader_light",function(t){var e=t.reader_light||"on";h("on"==e?"off":"on")})},u=function(){cookie.get("reader_setting",function(t){var e=t.reader_setting||{},i=e.space||25,n=e.zoom||100;m.setting={zoom:n,space:i}})},p=function(){$(m.playBtn).click(x),$(m.exitBtn).click(v),$(m.launchBtn).click(f),$(m.settingBtn).click(b),$(m.lightBtn).click(function(){var t=$(this).attr("data-status");h(t)}),$(m.restoreBtn).click(T),$(m.wrap).click(function(t){t.stopPropagation(),$(m.settingBtn).parent().removeClass("active"),$(m.settingBtn).parent().find("i.ddl-comic-right-icon").hide(),$(m.settingBtn).parent().find("div.ddl-comic-reader-setting").hide(),$(m.settingBtn).attr("data-status",0)}),$(m.settingBox).click(function(t){t.stopPropagation()})},f=function(){var t=config.getOptions("height");m.bodyScrollTop=$(document).scrollTop(),$("html,body").animate({scrollTop:0},0),$("body").css("height",t),$("body").css("overflow","hidden"),$("body").css("display","none"),$(m.main).css("height",t-75),$(m.wrap).show(),$(m.menu).show(),$(m.launchBtn).hide()},h=function(t){if("on"==t)return cookie.set("reader_light","off"),$(m.wrap).find("div.ddl-comic-inner").addClass("ddl-close-light-inner"),$(m.menu).find("ul.ddl-comic-menu-inner").addClass("ddl-close-light-inner"),$(m.lightBtn).addClass("icon-off-light").removeClass("icon-on-light"),$(m.lightBtn).attr("data-status","off"),!1;cookie.set("reader_light","on"),$(m.wrap).find("div.ddl-comic-inner").removeClass("ddl-close-light-inner"),$(m.menu).find("ul.ddl-comic-menu-inner").removeClass("ddl-close-light-inner"),$(m.lightBtn).removeClass("icon-off-light").addClass("icon-on-light"),$(m.lightBtn).attr("data-status","on")},v=function(){var t=config.getOptions("height"),e=$("body").attr("style");e=(e=(e=e.replace("height: "+t+"px;","")).replace("overflow: hidden;","")).replace("display: none;",""),$("body").attr("style",base.trim(e)),$(m.wrap).hide(),$(m.menu).hide(),$(m.launchBtn).show(),$("html,body").animate({scrollTop:m.bodyScrollTop},0)},b=function(){if(1==$(m.settingBtn).attr("data-status"))return $(m.settingBtn).parent().removeClass("active"),$(m.settingBtn).parent().find("i.ddl-comic-right-icon").hide(),$(m.settingBtn).parent().find("div.ddl-comic-reader-setting").hide(),$(m.settingBtn).attr("data-status",0),!1;$(m.settingBtn).parent().addClass("active"),$(m.settingBtn).parent().find("i.ddl-comic-right-icon").show(),$(m.settingBtn).parent().find("div.ddl-comic-reader-setting").show(),$(m.settingBtn).attr("data-status",1),cookie.get("reader_setting",function(t){var e=t.reader_setting||{},i=e.zoom||100,n=e.space||25;I("ddl-comic-reader-zoom",i,20,300),I("ddl-comic-reader-space",n,0,100)})},y=function(e,i){var n=$(m.item+"-"+e),a=new Image;a.src=i,a.onload=function(){m.list[e].width=a.width,m.list[e].height=a.height,$(m.item+"-"+e).css("width",a.width*m.setting.zoom/100),$(m.item+"-"+e).css("height",a.height*m.setting.zoom/100);var t='<div class="ddl-comic-image-main"><img src="'+i+'" draggable="false"/></div>';n.html(t)},a.onerror=function(){m.list[e].status=!1,console.log("图片加载失败",e)}},w=function(t,e){var i=m.files[e];console.log("files",m.files),console.log(e,m.files[e]);var n=new FileReader;n.readAsDataURL(i),n.onloadend=function(){y(t,this.result)}},k=function(){$(document).on({dragleave:function(t){t.preventDefault()},drop:function(t){t.preventDefault()},dragenter:function(t){t.preventDefault()},dragover:function(t){t.preventDefault()}})},B=function(){var f=$(m.main).scrollTop();$(m.main).scroll(function(){var t=parseInt($(m.totalPage).html())-1,e=$(this).scrollTop(),i=e-f;for(var n in 0<i&&52<=e&&($(".ddl-comic-top").css("background","transparent"),$(".ddl-comic-top").css("box-shadow","inherit"),$(".ddl-comic-top").css("z-index","2"),$(".ddl-comic-top div.ddl-comic-title").hide(),$("#ddl-comic-exit-btn").hide()),i<0&&52<e&&($(".ddl-comic-top").removeAttr("style"),$(".ddl-comic-top div.ddl-comic-title").show(),$("#ddl-comic-exit-btn").show()),f=e,m.list)if(0==m.list[n].status){var a=m.item+"-"+n;(d=$(a).offset().top)+100<e&&g(n)}for(var n in m.list){var o=parseInt(n)+1>t?t:parseInt(n)+1,r=document.getElementById("ddl-comic-item-"+n),c=document.getElementById("ddl-comic-item-"+o),s=C(r),l=C(c),d=s.y,u=l.y,p=parseInt(1*$(window).height()/2);if(d<=e&&e<u-p&&n!=t){$(m.currentPage).html(parseInt(n)+1);break}if(u-p<=e&&n==t){$(m.currentPage).html(parseInt(n)+1);break}}})},x=function(){tipsBox.floating({template:"user/play"}),$("#ddl-play-close-btn").click(function(){tipsBox.hideFloating()})},T=function(){var t=25;I("ddl-comic-reader-zoom",100,20,300),setTimeout(function(){I("ddl-comic-reader-space",t,0,100)},10)},C=function(t){for(var e=t.offsetLeft,i=t.offsetParent;null!==i;)e+=i.offsetLeft,i=i.offsetParent;var n=t.offsetTop;for(i=t.offsetParent;null!==i;)n+=i.offsetTop+i.clientTop,i=i.offsetParent;return{x:e,y:n}},I=function(t,e,i,n){tpl.renderTpl("#"+t+"-box","reader/powerange",{key:t});var a=document.querySelector("#"+t);document.getElementById(t+"-value").innerHTML=e,new Powerange(a,{key:t,start:e,min:i,max:n,hideRange:!0,callback:function(){var n=this,a=$("#"+this.key).val();document.getElementById(this.key+"-value").innerHTML=a,cookie.get("reader_setting",function(t){var e=t.reader_setting||{},i=n.key.replace("ddl-comic-reader-","");!function(t,e){switch(m.setting[t]=e,t){case"zoom":for(var i in m.list)$(m.item+"-"+i).css("width",m.list[i].width*m.setting.zoom/100),$(m.item+"-"+i).css("height",m.list[i].height*m.setting.zoom/100);break;case"space":$(".ddl-comic-image-box").css("margin-bottom",e+"px")}}(i,e[i]=a)})}})};return{init:function(){$(m.uploadBtn).change(function(){i(this.files)}),$(m.sceneBtn).click(function(t){event.stopPropagation(),e($(this))}),$(m.sceneBox).find("li").click(function(){t($(this))}),$(m.bugBtn).click(function(){tipsBox.alert("请将Bug问题发送到:326311036@qq.com邮箱,谢谢")}),$("body").click(function(t){t.stopPropagation(),$(m.sceneBox).find("em").hide(),$(m.sceneBox).find("ul").hide(),$("#ddl-comic-reader-scene-btn").attr("data-status",0)}),cookie.get("reader_scene",function(t){var e=t.reader_scene||{title:"Zip压缩包",type:"zip"};a(e.title,e.type)}),u(),k(),o()},loadImage:y}}(),ddlSearch=function(){var l={keyword:"#ddl-comic-search-keyword",searchBtn:"#ddl-comic-search-btn",searchInput:"#ddl-comic-search-input",authorBtn:".search-author-btn",unfoldBtn:".unfold-btn",fewerBtn:".fewer-btn",status:!0},i=function(s,t){if(0==l.status)return!1;var e={keyword:s,type:t=t||""};l.status=!1,ajRequest.post("comic/search",e,function(t){l.status=!0;var e=[];for(var i in t.data)for(var n in t.data[i].comic_catalog){var a=base.getDataLength(t.data[i].comic_catalog[n].list);t.data[i].comic_catalog[n].list=ddlUnit.setComicSort(t.data[i].comic_catalog[n].list,t.data[i].comic_type,a),t.data[i].comic_catalog[n].list=ddlUnit.resetChapterTitle(t.data[i].comic_catalog[n].list,t.data[i].comic_title);var o={title:t.data[i].comic_title,cover:t.data[i].comic_cover,author:t.data[i].comic_author,intro:t.data[i].comic_intro,catalog:t.data[i].comic_catalog[n],status:0==t.data[i].comic_status?"连载中":"已完结",type:t.data[i].comic_type,total:a,last:0!=a?t.data[i].comic_catalog[n].list[a-1]:{title:"",url:""},link:t.data[i].comic_link};e.push(o)}$(l.keyword).html(s),$(l.searchInput).val(s);var r="#ddl-comic-search-items-box";if(0<base.getDataLength(e)){var c="search/item";tpl.renderTpl(r,c,{list:e}),d()}else{c="search/nothing";tpl.renderTpl(r,c)}},function(t){l.status=!0})},d=function(){$(l.unfoldBtn).click(function(t){t.stopPropagation(),$(this).hide(),$(this).parent().css("height","auto")}),$(l.fewerBtn).click(function(t){t.stopPropagation(),$(this).parent().removeAttr("style"),$(this).prev().show()}),$(l.authorBtn).click(function(t){t.stopPropagation();var e=$(this).html();base.isEmptyValue(e)||i(e,"author")})};return{init:function(){var t=base.getQueryString("keyword");base.isEmptyValue(t)||(t=decodeURIComponent(t)),i(t),$(l.searchBtn).click(function(t){t.stopPropagation();var e=$(l.searchInput).val();if(base.isEmptyValue(e))return!1;i(e)}),$(l.searchInput).bind("keypress",function(t){if(t.stopPropagation(),"13"==t.keyCode){var e=$(this).val();if(base.isEmptyValue(e))return!1;i(e)}})}}}(),ddlSite=function(){var t=".ddl-comic-site-tab",e=".ddl-comic-site-jump",i=function(t){var e={},i=ddlUnit.getWebList();if("all"==t)e=i;else for(var n in i)i[n].type==t&&(e[n]=i[n]);tpl.renderTpl(".ddl-comic-main ul","site/items",{list:e}),a()},a=function(){$(e).click(function(){var t=$(this).attr("data-url");base.jumpUrl(t,"_blank")})};return{init:function(){tpl.renderTpl(".ddl-comic-main","site/index",{list:ddlUnit.getWebList()}),a(),$(t).click(function(){$(this).addClass("active"),$(this).siblings().removeClass("active"),i($(this).attr("data-type"))})},tabs:i,getSiteField:function(t,e){return ddlUnit.getWebList()[t][e]},setBackgroundAuto:function(t){switch(t){case"hhimm":case"52wuxing":return"background-size: auto";case"hhxxee":case"imanhuaw":case"sfacg":return"background-size: 80%";case"manhuagui":return"background-size: 90%"}return""}}}(),ddlUser=function(){var t="#ddl-comic-user-play",e="#ddl-comic-version",a=function(t,e,i,n){tpl.renderTpl("#"+t+"-box","user/powerange",{key:t});var a=document.querySelector("#"+t);document.getElementById(t+"-value").innerHTML=e,new Powerange(a,{key:t,start:e,min:i,max:n,hideRange:!0,callback:function(){var n=this,a=$("#"+this.key).val();document.getElementById(this.key+"-value").innerHTML=a,cookie.get("setting",function(t){var e=t.setting||{},i=n.key.replace("ddl-comic-","");e[i]=a,cookie.set("setting",e),chrome.tabs.query({active:!0,currentWindow:!0},function(t){var e={type:"personalSetting",key:i,value:a};chrome.tabs.sendMessage(t[0].id,e,function(t){})})})}})},i=function(){tipsBox.floating({template:"user/play"}),$("#ddl-play-close-btn").click(function(){tipsBox.hideFloating()})};return{init:function(){tpl.renderTpl(".ddl-comic-main","user/index"),cookie.get("setting",function(t){var e=t.setting||{},i=e.zoom||100,n=e.space||25;a("ddl-comic-zoom",i,20,300),a("ddl-comic-space",n,0,100)}),$(t).click(i),ajRequest.get("./manifest.json",{},function(t){$(e).html(t.version)})}}}(),ajRequest=function(){var o=function(t){var e=t.url,i=t.data,n=t.success,a=t.error,o=t.complete,r=t.timeout||5e3;$.ajax({type:"post",url:e,data:i,timeout:r,dataType:"json",success:function(t){"function"==typeof n&&n(t)},error:function(t){"function"==typeof a&&a(t)},complete:function(){"function"==typeof o&&o()}})},n=function(t){var e=t.url,i=t.data,n=t.success,a=t.error,o=t.complete;$.ajax({type:"get",url:e,data:i,dataType:"jsonp",success:function(t){"function"==typeof n&&n(t)},error:function(t){"function"==typeof a&&a(t)},complete:function(){"function"==typeof o&&o()}})};return{get:function(t,e,i){if("m.com"===window.location.host)return n({url:t,data:e,success:i}),!1;chrome.extension.sendMessage({url:t,data:e},function(t){i(t)})},post:function(t,e,i,n,a){if("m.com"===window.location.host)return o({url:config.getApiUrl(t),data:e,success:i,error:n,complete:a}),!1;chrome.extension.sendMessage({url:config.getApiUrl(t),data:e},function(t){base.isEmptyValue(t)?n(t):i(t)})}}}(),tpl={getTpl:function(t,e){return t=config.getOptions("templateUrl")+t,template(t,e)},renderTpl:function(t,e,i,n){i=i||{},e=config.getOptions("templateUrl")+e;var a=template(e,i);switch(n=n||0){case 0:$(t).html(a);break;case 1:$(t).append(a);break;case 2:$(t).prepend(a);break;case 3:$(t).after(a);break;case 4:$(t).before(a)}}};template.helper("setBackgroundAuto",function(t){return ddlSite.setBackgroundAuto(t)}),template.helper("getSiteField",function(t,e){return ddlSite.getSiteField(t,e)}),template.helper("getTimeAgo",function(t){return ddlFavor.getTimeAgo(t)}),template.helper("resetChapterName",function(t,e){return ddlFavor.resetChapterName(t,e)});