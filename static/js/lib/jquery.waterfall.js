!function(e){var s=e(window),i="waterfall",o={itemClass:"waterfall-item",spacingWidth:10,spacingHeight:10,minColCount:2,resizeable:!1,itemAlign:"center",isFadeIn:!0,ajaxCallback:null};function n(t,i){this.$element=e(t),this.options=e.extend(!0,{},o,i),this.ajaxLoading=!1,this.colHeightArray=[],this._init()}n.prototype={constructor:n,_init:function(){var t=this;s.on("load",function(){t._positionAll()}),t._positionAll(),this.options.resizeable&&s.on("resize",function(){t._positionAll()}),this._doScroll()},_getColumnCount:function(){var t,i=this.$element.width(),o=e(this.options.itemClass).eq(0).outerWidth(),s=Math.floor(i/(o+this.options.spacingWidth)),n=0;(t=(s=s>this.options.minColCount?s:this.options.minColCount)*o)<i&&(n=Math.floor((i-t-s*this.options.spacingWidth)/2)),this.itemWidth=o,this.cols=s,this.leftOffset="center"==this.options.itemAlign?n:0},_positionAll:function(){var i,o,s=this,n=e(this.options.itemClass);this._getColumnCount(),this.colHeightArray=[],n.each(function(t){e(this).css("position","absolute"),t<s.cols?(e(this).css("top",0),e(this).css("left",s.leftOffset+t*s.itemWidth+t*s.options.spacingWidth),s.colHeightArray.push(e(this).outerHeight())):(i=Math.min.apply(null,s.colHeightArray),o=e.inArray(i,s.colHeightArray),e(this).css("top",i+s.options.spacingHeight),e(this).css("left",n.eq(o).position().left),s.colHeightArray[o]+=e(this).outerHeight()+s.options.spacingHeight),s.options.isFadeIn&&e(this).animate({opacity:1},300)}),this.$element.css("height",Math.max.apply(null,s.colHeightArray))},_doScroll:function(){var t,o=this;s.on("scroll",function(){t&&clearTimeout(t),t=setTimeout(function(){var t=e(o.options.itemClass).last(),i=s.scrollTop()+s.height();!o.ajaxLoading&&i>t.offset().top+t.outerHeight()/2&&(o.ajaxLoading=!0,o.options.ajaxCallback&&o.options.ajaxCallback(function(){o._positionAll()},function(){o.ajaxLoading=!1}))},100)})}},e.fn[i]=function(t){return this.each(function(){e.data(this,"plugin_"+i)||e.data(this,"plugin_"+i,new n(this,t))}),this}}(jQuery);